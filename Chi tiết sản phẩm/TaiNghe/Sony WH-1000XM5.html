<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sony WH-1000XM5 - Chi tiết sản phẩm</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../style.css">
</head>
<body class="ctsp">
    <header class="header">
        <div class="top-row">
            <img src="" alt="Logo" class="logo">
            <div class="center-group">
                <a href="#" class="menu-link">Giới thiệu</a>
                    <div class="dropdown">
                        <button class="menu-btn"><i class="fas fa-bars"></i> Danh mục</button>
                            <div class="dropdown-content">
                            <div class="submenu">
                                <a href="Dienthoai.html">Điện thoại</a>
                                    <div class="submenu-content">
                                        <a href="Trang Dienthoai của hãng/iphone.html">Apple</a>
                                        <a href="Trang Dienthoai của hãng/samsung.html">Samsung</a>
                                        <a href="Trang Dienthoai của hãng/oppo.html">Oppo</a>
                                        <a href="Trang Dienthoai của hãng/xiaomi.html">Xiaomi</a>
                                        <a href="Trang Dienthoai của hãng/realme.html">Realme</a>
                                        <a href="Trang Dienthoai của hãng/vivo.html">Vivo</a>
                                    </div>
                            </div>

                            <div class="submenu">
                                <a href="#">Máy tính</a>
                                <div class="submenu-content">
                                    <a href="#">Apple</a>
                                    <a href="#">Lenovo</a>
                                    <a href="#">ASUS</a>
                                    <a href="#">Acer</a>
                                    <a href="#">HP</a>
                                    <a href="#">Dell</a>
                                </div>
                            </div>

                            <div class="submenu">
                                <a href="#">PC</a>
                                <div class="submenu-content">
                                    <a href="#">CPU</a>
                                    <a href="#">Mainboard</a>
                                    <a href="#">VGA</a>
                                    <a href="#">RAM</a>
                                    <a href="#">Vỏ PC</a>
                                    <a href="#">Thiết bị lưu trữ</a>
                                </div>
                            </div>

                            <div class="submenu">
                                <a href="#">Phụ kiện</a>
                                <div class="submenu-content">
                                    <a href="#">Chuột</a>
                                    <a href="#">Bàn phím</a>
                                    <a href="#">Tai nghe</a>
                                    <a href="#">Webcam</a>
                                </div>
                            </div>
                            </div>
                        </div>
                <div class="search-bar">
                    <input type="text" placeholder="Nhập tên điện thoại, máy tính, phụ kiện... cần tìm">
                    <button><i class="fas fa-search"></i></button>
                </div>
            </div>
            <div class="user-cart">
                <button class="icon-btn"><i class="fas fa-user"></i></button>
                <button class="cart-btn"><i class="fas fa-shopping-cart"></i> Giỏ hàng</button>
            </div>
        </div>
    </header>
    <main class="container my-4">
        <nav aria-label="breadcrumb" class="breadcrumb-nav">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Trang chủ</a></li>
                <li class="breadcrumb-item"><a href="#">Phụ Kiện</a></li>
                <li class="breadcrumb-item"><a href="#">Tai Nghe</a></li>
                <li class="breadcrumb-item active" aria-current="page">Sony WH-1000XM5</li>
            </ol>
        </nav>

        <section class="product-detail-main">
            <div class="row">
                <div class="col-lg-6">
                    <div class="product-gallery">
                        <div class="main-image-container">
                            <img src="../Ảnh trong chi tiết sản phẩm/Sony WH-1000XM5/Sony WH-1000XM5 Đen.webp" 
                                alt="Sony WH-1000XM5 - Màu Đen" 
                                class="img-fluid main-product-image" id="mainImage">
                        </div>
                        <div class="thumbnail-images">
                            <img src="../Ảnh trong chi tiết sản phẩm/Sony WH-1000XM5/Sony WH-1000XM5 Đen.webp" 
                                alt="Thumbnail Sony WH-1000XM5 - Màu Đen" 
                                class="thumbnail active" 
                                onclick="changeImage(this.src, this.alt)"> 
                            <img src="../Ảnh trong chi tiết sản phẩm/Sony WH-1000XM5/Sony WH-1000XM5 gt2.webp" 
                                alt="Thumbnail Sony WH-1000XM5 gt2" 
                                class="thumbnail" 
                                onclick="changeImage(this.src, this.alt)">
                            <img src="../Ảnh trong chi tiết sản phẩm/Sony WH-1000XM5/Sony WH-1000XM5 gt1.webp" 
                                alt="Thumbnail Sony WH-1000XM5 gt2" 
                                class="thumbnail" 
                                onclick="changeImage(this.src, this.alt)">
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="product-info">
                        <h1 class="product-title">Sony WH-1000XM5</h1>
                        <div class="product-meta">
                            <span>Thương hiệu: <a href="#" class="text-primary">Sony</a></span>
                            <span class="mx-2">|</span>
                            <span>SKU: </span>
                        </div>

                        <div class="price-section">
                            <span class="price-newctsp">8.091.000 ₫</span>
                            <span class="price-oldctsp">8.990.000 ₫</span>
                            <span class="discount-badge">-10%</span>
                        </div>
                        
                        <div class="variant-selection">
                        <p><strong>Chọn màu sắc:</strong></p>
                        <div class="colors">
                            <button class="color-swatch active" style="background-color: black;"data-color="Đen"></button>
                            <button class="color-swatch" style="background-color: gray;" data-color="Bạc"></button>
                            <button class="color-swatch" style="background-color: #516886;" data-color="Xanh ánh trăng"></button>
                            <button class="color-swatch" style="background-color: #FFEBD8;" data-color="Hồng kem"></button>
                        </div>
                        </div>

                        <div class="product-promo">
                            <p class="font-weight-bold mb-2">Ưu đãi đặc biệt:</p>
                            <ul>
                                <li><i class="fas fa-check-circle text-success"></i> Giảm thêm <strong>500.000đ</strong> khi thanh toán qua VNPAY.</li>
                                <li><i class="fas fa-check-circle text-success"></i> Hỗ trợ trả góp 0% lãi suất qua thẻ tín dụng.</li>
                                <li><i class="fas fa-check-circle text-success"></i> Miễn phí vận chuyển toàn quốc.</li>
                            </ul>
                        </div>
                        
                        <div class="quantity-section">
                             <p><strong>Số lượng:</strong></p>
                             <div class="quantity-selector">
                                <button class="btn-quantity" id="decrease-qty">-</button>
                                <input type="number" id="quantity" value="1" min="1">
                                <button class="btn-quantity" id="increase-qty">+</button>
                            </div>
                        </div>

                        <div class="product-buttons">
                            <button class="btn-buy-now">Mua ngay</button>
                            <button class="btn-add-cart"><i class="fas fa-cart-plus"></i> Thêm vào giỏ</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="product-description-specs mt-5">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="description-tab" data-toggle="tab" href="#description" role="tab">Mô tả sản phẩm</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="specs-tab" data-toggle="tab" href="#specs" role="tab">Thông số kỹ thuật</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="reviews-tab" data-toggle="tab" href="#reviews" role="tab">Đánh giá (3)</a>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="description" role="tabpanel">
                <h4 class="mt-4">Sony WH-1000XM5: Trải Nghiệm Âm Thanh Tuyệt Đối Với Công Nghệ Khử Tiếng Ồn Hàng Đầu</h4>
                <p>Sony WH-1000XM5 là thế hệ tai nghe không dây chống ồn chủ động mới nhất từ Sony, tiếp nối thành công của dòng sản phẩm WH-1000X trứ danh. Được thiết kế tinh tế cùng hàng loạt công nghệ âm thanh tiên tiến, WH-1000XM5 mang đến một không gian nghe nhạc tĩnh lặng vượt trội, chất âm đỉnh cao và sự thoải mái tối ưu cho người dùng, dù bạn đang làm việc, di chuyển hay chỉ đơn giản là muốn đắm chìm trong thế giới âm nhạc của riêng mình.</p>
                <h5>Đặc điểm nổi bật</h5>
                <ul>
                    <li><strong>Công nghệ chống ồn chủ động hàng đầu thị trường:</strong> Tích hợp bộ xử lý HD Noise Cancelling Processor QN1 và bộ xử lý tích hợp V1, kết hợp cùng hệ thống đa micro (tám micro) giúp thu và phân tích tiếng ồn xung quanh một cách chính xác, mang lại khả năng khử ồn vượt trội chưa từng có. Tính năng Auto NC Optimizer tự động tối ưu hóa chống ồn dựa trên điều kiện đeo và môi trường.</li>
                    <li><strong>Chất lượng âm thanh Hi-Res tuyệt đỉnh:</strong> Trang bị màng loa 30mm được thiết kế đặc biệt với vòm loa mềm và cấu trúc carbon composite nhẹ và cứng, tái tạo âm thanh chi tiết, rõ ràng ở mọi dải tần. Hỗ trợ codec LDAC cho trải nghiệm nghe nhạc không dây chất lượng cao Hi-Res Audio Wireless và công nghệ DSEE Extreme™ giúp nâng cấp các file nhạc nén theo thời gian thực.</li>
                    <li><strong>Thiết kế "Noiseless Design" sang trọng và thoải mái:</strong> Kiểu dáng mới tinh tế, nhẹ hơn đáng kể so với thế hệ trước. Phần đệm tai và quai đeo được làm từ da tổng hợp mềm mại, ôm khít và phân bổ áp lực đều, mang lại sự thoải mái tối đa ngay cả khi sử dụng trong nhiều giờ liền.</li>
                    <li><strong>Chất lượng đàm thoại vượt trội:</strong> Công nghệ Precise Voice Pickup sử dụng bốn micro beamforming và thuật toán giảm tiếng ồn dựa trên AI, giúp lọc bỏ tạp âm hiệu quả, mang lại giọng nói trong trẻo và rõ ràng cho các cuộc gọi. Cấu trúc giảm tiếng gió cũng được cải tiến.</li>
                    <li><strong>Thời lượng pin ấn tượng và sạc nhanh:</strong> Nghe nhạc liên tục lên đến 30 giờ khi bật chống ồn (và 40 giờ khi tắt chống ồn). Hỗ trợ sạc nhanh qua cổng USB-C Power Delivery, chỉ với 3 phút sạc có thể sử dụng thêm đến 3 giờ.</li>
                    <li><strong>Tính năng thông minh và kết nối đa dạng:</strong> Tích hợp các tính năng thông minh như Speak-to-Chat (tự động dừng nhạc khi bạn nói chuyện), Adaptive Sound Control (tự điều chỉnh cài đặt âm thanh theo hoạt động), cảm biến phát hiện đeo tai. Hỗ trợ kết nối đa điểm Bluetooth (Multipoint Connection) cho phép kết nối cùng lúc với hai thiết bị.</li>
                    <li><strong>Thân thiện với môi trường:</strong> Nhiều bộ phận của tai nghe và bao bì được làm từ vật liệu tái chế, thể hiện cam kết của Sony đối với sự phát triển bền vững.</li>
                </ul>
            </div>

                <div class="tab-pane fade" id="specs" role="tabpanel">
                <h4 class="mt-4">Thông số kỹ thuật chi tiết Sony WH-1000XM5</h4>
                <table class="table table-striped table-bordered mt-3">
                    <tbody>
                    <tr>
                        <th scope="row">Thương hiệu:</th>
                        <td>Sony</td>
                    </tr>
                    <tr>
                        <th scope="row">Model:</th>
                        <td>WH-1000XM5</td>
                    </tr>
                    <tr>
                        <th scope="row">Màu sắc:</th>
                        <td>Đen, Bạc (Tùy phiên bản)</td> </tr>
                    <tr>
                        <th scope="row">Kiểu kết nối:</th>
                        <td>Không dây (Bluetooth 5.2), Có dây (qua cổng 3.5mm)</td>
                    </tr>
                    <tr>
                        <th scope="row">Kích thước:</th>
                        <td>Dài 27.62 cm - Rộng 21.67 cm - Cao 7.59 cm (Lưu ý: có thể là kích thước đóng gói)</td>
                    </tr>
                    <tr>
                        <th scope="row">Trọng lượng:</th>
                        <td>Khoảng 250 g</td>
                    </tr>
                    <tr>
                        <th scope="row">Công nghệ âm thanh:</th>
                        <td>SENSE ENGINE, Bộ xử lý tích hợp V1, DSEE Extreme (Cơ chế tăng cường âm thanh kỹ thuật số), Hi-Res Audio, codec SBC, Active Noise Cancelling (Chống ồn chủ động), Chống ồn HD QN1, codec LDAC, Ambient Sound (Âm thanh xung quanh), codec AAC, 360 Reality Audio, Adaptive Sound Control (Kiểm soát âm thanh thích ứng)</td>
                    </tr>
                    <tr>
                        <th scope="row">Micro:</th>
                        <td>Có (Tích hợp nhiều micro với công nghệ Precise Voice Pickup)</td>
                    </tr>
                    <tr>
                        <th scope="row">Cổng kết nối audio:</th>
                        <td>3.5mm</td>
                    </tr>
                    <tr>
                        <th scope="row">Cổng sạc:</th>
                        <td>USB Type-C</td>
                    </tr>
                    <tr>
                        <th scope="row">Thời lượng pin (Ước tính):</th>
                        <td>Lên đến 30 giờ (Bật chống ồn ANC)<br>Lên đến 40 giờ (Tắt chống ồn ANC)</td>
                    </tr>
                    <tr>
                        <th scope="row">Thời gian sạc đầy (Ước tính):</th>
                        <td>Khoảng 3.5 giờ (Sạc nhanh: 3 phút sạc cho 3 giờ sử dụng)</td>
                    </tr>
                    <tr>
                        <th scope="row">Phương thức điều khiển:</th>
                        <td>Cảm ứng chạm trên tai nghe</td>
                    </tr>
                    <tr>
                        <th scope="row">Tính năng khác:</th>
                        <td>Speak-to-Chat (Tự động dừng nhạc khi trò chuyện), Kết nối đa điểm (Multipoint connection), Điều khiển bằng giọng nói (Google Assistant, Alexa), Google Fast Pair, Swift Pair</td>
                    </tr>
                </tbody>
                </table>
            </div>

                <div class="tab-pane fade" id="reviews" role="tabpanel">
                    <h4 class="mt-4">Đánh giá từ khách hàng</h4>
                    </div>
            </div>
            <div id="toast" style="visibility: hidden; min-width: 250px; background-color: #4CAF50; color: white; text-align: center; border-radius: 8px; padding: 16px; position: fixed; z-index: 1000; left: 50%; top: 50%; transform: translate(-50%, -50%); font-size: 17px; opacity: 0; transition: opacity 0.5s ease-in-out;">
        </div>
        </section>

         <section class="related-products mt-5">
            <h3 class="text-center mb-4">Sản phẩm tương tự</h3>
            <div class="row">
                </div>
        </section>
    </main>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
    <script src="../../sanpham.js"></script> 

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- KHAI BÁO BIẾN TOÀN CỤC CHO SCRIPT NÀY ---
        const mainImage = document.getElementById('mainImage');
        const thumbnails = document.querySelectorAll('.thumbnail-images .thumbnail');
        const colorSwatches = document.querySelectorAll('.color-swatch');
        const quantityInput = document.getElementById('quantity');
        const decreaseBtn = document.getElementById('decrease-qty');
        const increaseBtn = document.getElementById('increase-qty');
        const relatedContainer = document.querySelector('.related-products .row');
        const currentProductTitle = document.querySelector('.product-title').textContent;

        // --- HÀM TIỆN ÍCH ---
        function calcPriceNew(priceOld, discountPercent) {
            if (typeof priceOld !== 'number' || typeof discountPercent !== 'number') {
                // console.error("Invalid input for calcPriceNew: priceOld or discountPercent is not a number.");
                return priceOld; // Trả về giá cũ nếu đầu vào không hợp lệ
            }
            return priceOld * (1 - discountPercent / 100);
        }

        function formatPrice(price) {
            if (typeof price !== 'number' || isNaN(price)) {
                // console.error("Invalid input for formatPrice: price is not a number.");
                return 'N/A'; // Hoặc một giá trị mặc định khác
            }
            return price.toLocaleString("vi-VN") + " ₫";
        }
        function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.style.visibility = 'visible';
        toast.style.opacity = '1';
        
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => {
                toast.style.visibility = 'hidden';
                }, 500);
            }, 2000);
        }
        // --- DỮ LIỆU ẢNH SẢN PHẨM THEO MÀU ---
        // Sếp cần cập nhật chính xác các đường dẫn hình ảnh cho sản phẩm này
        const productImagesByColor = {
            "Đen": {
                main: "../Ảnh trong chi tiết sản phẩm/Sony WH-1000XM5/Sony WH-1000XM5 Đen.webp",
                thumbnail_main: "../Ảnh trong chi tiết sản phẩm/Sony WH-1000XM5/Sony WH-1000XM5 Đen.webp"
            },
            "Bạc": {
                main: "../Ảnh trong chi tiết sản phẩm/Sony WH-1000XM5/Sony WH-1000XM5 Bạc.webp",
                thumbnail_main: "../Ảnh trong chi tiết sản phẩm/Sony WH-1000XM5/Sony WH-1000XM5 Bạc.webp"
            },
            "Xanh ánh trăng": {
                main: "../Ảnh trong chi tiết sản phẩm/Sony WH-1000XM5/Sony WH-1000XM5 Xanh ánh trăng.webp",
                thumbnail_main: "../Ảnh trong chi tiết sản phẩm/Sony WH-1000XM5/Sony WH-1000XM5 Xanh ánh trăng.webp"
            },
            "Hồng kem": {
                main: "../Ảnh trong chi tiết sản phẩm/Sony WH-1000XM5/Sony WH-1000XM5 Hồng kem.webp",
                thumbnail_main: "../Ảnh trong chi tiết sản phẩm/Sony WH-1000XM5/Sony WH-1000XM5 Hồng kem.webp"
            },
        };

        // --- IMAGE GALLERY LOGIC ---
        window.changeImage = function(newSrc, newAlt) { // Thêm newAlt để cập nhật alt text
            if (mainImage) {
                mainImage.src = newSrc;
                if (newAlt) {
                    mainImage.alt = newAlt;
                }
            }

            thumbnails.forEach(thumb => {
                thumb.classList.remove('active');
                // So sánh phần cuối của src để tránh vấn đề với đường dẫn tuyệt đối/tương đối
                if (thumb.src.endsWith(newSrc.substring(newSrc.lastIndexOf('/') + 1))) {
                    thumb.classList.add('active');
                }
            });
        };
        
        // Gán sự kiện cho thumbnail ban đầu (nếu sếp không muốn dùng onclick trong HTML)
        thumbnails.forEach(thumb => {
            thumb.addEventListener('click', function() {
                changeImage(this.src, this.alt);
            });
        });


        // --- COLOR SWATCH LOGIC ---
        colorSwatches.forEach(swatch => {
            swatch.addEventListener('click', function() {
                colorSwatches.forEach(s => s.classList.remove('active'));
                this.classList.add('active');

                const selectedColor = this.dataset.color;
                const newImageData = productImagesByColor[selectedColor];

                if (newImageData && mainImage) {
                    mainImage.src = newImageData.main;
                    mainImage.alt = `Razer DeathAdder V3 Pro - ${selectedColor}`;

                    if (thumbnails.length > 0 && newImageData.thumbnail_main) {
                        // Cập nhật thumbnail đầu tiên và gọi changeImage để đồng bộ trạng thái active
                        thumbnails[0].src = newImageData.thumbnail_main;
                        thumbnails[0].alt = `Thumbnail ${selectedColor}`;
                        changeImage(newImageData.thumbnail_main, `Thumbnail ${selectedColor}`); 
                    }
                } else if (!newImageData) {
                    console.warn(`Không tìm thấy cấu hình ảnh cho màu: ${selectedColor}`);
                }
            });
        });
        
        // --- LOGIC ĐẶT MÀU MẶC ĐỊNH KHI TẢI TRANG ---
        const defaultColor = "Đen"; // Màu mặc định khi tải trang
        const defaultColorSwatch = document.querySelector(`.color-swatch[data-color="${defaultColor}"]`);
        if (defaultColorSwatch) {
            // Giả lập một click để kích hoạt logic thay đổi ảnh và active class
            // Hoặc trực tiếp gọi hàm cập nhật ảnh như dưới
            const defaultImageData = productImagesByColor[defaultColor];
            if (defaultImageData && mainImage) {
                 mainImage.src = defaultImageData.main;
                 mainImage.alt = `Logitech G Pro X TKL Lightspeed - ${defaultColor}`;
                 if (thumbnails.length > 0 && defaultImageData.thumbnail_main) {
                    thumbnails[0].src = defaultImageData.thumbnail_main;
                    thumbnails[0].alt = `Thumbnail ${defaultColor}`;
                    changeImage(defaultImageData.thumbnail_main, `Thumbnail ${defaultColor}`);
                 }
                 colorSwatches.forEach(s => s.classList.remove('active'));
                 defaultColorSwatch.classList.add('active');
            }
        }


        // --- QUANTITY COUNTER LOGIC ---
        if(decreaseBtn && increaseBtn && quantityInput) {
            decreaseBtn.addEventListener('click', function() {
                let currentValue = parseInt(quantityInput.value);
                if (currentValue > 1) {
                    quantityInput.value = currentValue - 1;
                }
            });

            increaseBtn.addEventListener('click', function() {
                let currentValue = parseInt(quantityInput.value);
                quantityInput.value = currentValue + 1; // Có thể thêm max limit nếu cần
            });
        }

        // --- BOOTSTRAP TABS INITIALIZATION ---
        $('#myTab a').on('click', function (e) {
            e.preventDefault();
            $(this).tab('show');
        });

        // --- HIỂN THỊ SẢN PHẨM TƯƠNG TỰ ---
        // Sếp đảm bảo biến "BanPhim" (hoặc tên biến trong sanpham.js) đã được tải và có dữ liệu
        const productsToShow = (typeof TaiNghe !== 'undefined' && Array.isArray(TaiNghe)) ? TaiNghe : []; 
        if (productsToShow && productsToShow.length > 0 && relatedContainer && currentProductTitle) {
    // Lọc ra các sản phẩm khác với sản phẩm hiện tại, xáo trộn và lấy 4 sản phẩm đầu tiên
    const randomRelatedProducts = productsToShow
        .filter(p => p.name !== currentProductTitle) // Lọc sản phẩm khác
        .sort(() => 0.5 - Math.random()) // Xáo trộn ngẫu nhiên
        .slice(0, 4); // Chọn 4 sản phẩm

    if (randomRelatedProducts.length > 0) {
        let productsHTML = ''; // Chuỗi HTML để chứa các sản phẩm liên quan

        // Tạo HTML cho mỗi sản phẩm liên quan
        randomRelatedProducts.forEach(product => {
            const priceNew = calcPriceNew(product.priceOld, product.discountPercent);
            productsHTML += `
                <div class="col-lg-3 col-md-4 col-6 mb-4">
                    <div class="productctsp-card h-100 d-flex flex-column">
                        <a href="#">
                            <img src="${product.image}" class="card-img-top" alt="${product.name}" style="height: 180px; object-fit: contain; background: white; border-bottom: 1px solid #eee; padding:10px;">
                        </a>
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title mb-2" style="font-size: 0.9rem; flex-grow: 1;">${product.name}</h5>
                            <div class="d-flex justify-content-between align-items-center mb-1 flex-wrap">
                                <span class="price-old">${formatPrice(product.priceOld)}</span>
                                ${product.discountPercent > 0 ? `<span class="discount text-danger">-${product.discountPercent}%</span>` : ""}
                            </div>
                            <h4 class="price-new mb-3" style="font-size: 1.1rem;">${formatPrice(priceNew)}</h4>
                            <button class="btn btn-danger btn-sm btn-block add-cart mt-auto" data-product-name="${product.name}">Thêm vào giỏ hàng</button>
                        </div>
                    </div>
                </div>
            `;
        });

        // Chèn HTML vào container
        relatedContainer.innerHTML = productsHTML;

        // Gắn sự kiện click cho TẤT CẢ các nút "Thêm vào giỏ hàng" MỚI được tạo
        const relatedAddCartBtns = relatedContainer.querySelectorAll('.add-cart');
        relatedAddCartBtns.forEach(btn => {
            btn.addEventListener('click', function() { // Sử dụng function() nếu bạn cần 'this' là button
                // Lấy tên sản phẩm từ data-attribute của nút được click
                const productName = this.dataset.productName; // Hoặc btn.dataset.productName nếu dùng arrow function
                
                showToast(`Đã thêm "${productName}" vào giỏ!`);

                // Tại đây, bạn cũng có thể lấy thêm thông tin sản phẩm (ví dụ: ID, giá)
                // nếu hàm xử lý giỏ hàng của bạn cần.
                // Ví dụ: const productId = this.dataset.productId; (nếu bạn có data-productId)
                // Và sau đó gọi hàm để thực sự thêm sản phẩm vào logic giỏ hàng của bạn.
            });
        });

    } else {
        // Không có sản phẩm liên quan nào phù hợp
        relatedContainer.innerHTML = '<p class="col-12 text-center">Không có sản phẩm tương tự.</p>';
    }
    } else if (relatedContainer) {
        // Xử lý trường hợp không có đủ dữ liệu đầu vào (ví dụ: productsToShow rỗng hoặc currentProductTitle không có)
        // nhưng relatedContainer vẫn tồn tại.
        relatedContainer.innerHTML = '<p class="col-12 text-center">Chưa có dữ liệu sản phẩm tương tự.</p>';
    }

        
    });

    // --- FETCH FOOTER ---
    fetch('../../footer.html') // Điều chỉnh đường dẫn tới footer.html cho đúng
        .then(res => {
            if (!res.ok) {
                throw new Error("Network response was not ok for footer.html");
            }
            return res.text();
        })
        .then(data => {
            const footerElement = document.getElementById('footer');
            if (footerElement) {
                footerElement.innerHTML = data;
            }
        })
        .catch(error => console.error('Error fetching footer:', error));

    </script>
</body>
</html>